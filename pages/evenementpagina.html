<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../styles/style.css">
    <style>
        
        body {
            display: flex;
            flex-direction: column;

        }

        .leftside {
            width: 50%;
            height: fit-content;
        }

        .rightside {
            width: 50%;
            height: fit-content;
            background-color: lightslategray;
        }

        td {
            padding-left: 10px;
            padding-right: 10px;
        }
    </style>

    <script> 
        let currentEvent;
        window.onload = function(){
            var eventid = window.location.href.split('=').pop();

            console.log(eventid);
                fetch(`http://localhost:8082/evenement/geefEvenement/${eventid}`).then((response)=> response.json()).then((data)=>{
                currentEvent = data;
                document.getElementById("evenementTitel").innerHTML = currentEvent.naam;
        })}
            
        function toonTracksPerEvenement(){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                var allTracksPerEvent = JSON.parse(this.responseText);
                HTMLString = "<table border=1>";
                HTMLString += "<tr><td>Naam</td> <td>Omschrijving</td></tr>"
                for(var i = 0; i < allTracksPerEvent.length; i++){
                    HTMLString += "<td>" + allTracksPerEvent[i].name + "</td>";
                    HTMLString += "<td>" + allTracksPerEvent[i].description + "</td>";
                    HTMLString += "<td><button onclick='verwijderTrack("+allTracksPerEvent[i].id+")'>Delete</button></td><tr>"
                }                   
                HTMLString += "</table>";

                HTMLString += "<h4>Track adding form</h4>";
                HTMLString += "Naam track: <input id='trackNaam'><br>";
                HTMLString += "Omschrijving: <input id='trackOmschrijving'><br>";
                HTMLString += "<button onclick='voegTrackToeAanEvenement(" + currentEvent.id + ")'>Add track</button>"
                document.getElementById("innerTable").innerHTML = HTMLString;                               
            }
            xhr.open("GET","http://localhost:8082/evenement/geefAlleTracksPerEvenement/" + currentEvent.id, true);
            xhr.send();
        }

        function toonLocatiesPerEvenement(){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                var allLocationsPerEvent = JSON.parse(this.responseText);
                HTMLString = "<table border=1>";
                HTMLString += "<tr><td>Naam</td> <td>Omschrijving</td> <td>Capaciteit</td></tr>"
                for(var i = 0; i < allLocationsPerEvent.length; i++){
                    HTMLString += "<td>" + allLocationsPerEvent[i].name + "</td>";
                    HTMLString += "<td>" + allLocationsPerEvent[i].description + "</td>"
                    HTMLString += "<td>" + allLocationsPerEvent[i].capacity + "</td>";
                    HTMLString += "<td><button onclick='verwijderLocatie("+allLocationsPerEvent[i].id+")'>Delete</button></td><tr>"
                }                   
                HTMLString += "</table>";

                HTMLString += "<h4>Track adding form</h4>";
                HTMLString += "Naam locatie: <input id='locatieNaam'><br>";
                HTMLString += "Omschrijving: <input id='locatieOmschrijving'><br>";
                HTMLString += "Capaciteit: <input id='locatieCapaciteit'><br>";
                HTMLString += "<button onclick='voegLocatieToeAanEvenement(" + currentEvent.id + ")'>Add location</button>"
                document.getElementById("innerTable").innerHTML = HTMLString;                               
            }
            xhr.open("GET","http://localhost:8082/evenement/geefAlleLocatiesPerEvenement/" + currentEvent.id, true);
            xhr.send();
        }

        function voegTrackToeAanEvenement(id){
            var xhr = new XMLHttpRequest();
            var trackToAdd = {};
            trackToAdd.name = document.getElementById("trackNaam").value;
            trackToAdd.description = document.getElementById("trackOmschrijving").value;
            JSONstatement = JSON.stringify(trackToAdd);      
            console.log(JSONstatement);         
            xhr.open("POST", "http://localhost:8082/evenement/voegTrackAanEvenementToe/" + id, true);          
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(JSONstatement);
        }

        function voegLocatieToeAanEvenement(id){
            var xhr = new XMLHttpRequest();
            var locationToAdd = {};
            locationToAdd.name = document.getElementById("locatieNaam").value;
            locationToAdd.description = document.getElementById("locatieOmschrijving").value;
            locationToAdd.capacity = document.getElementById("locatieCapaciteit").value;
            JSONstatement = JSON.stringify(locationToAdd);      
            console.log(JSONstatement);         
            xhr.open("POST", "http://localhost:8082/evenement/voegLocatieAanEvenementToe/" + id, true);          
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(JSONstatement);
        }

        function verwijderTrack(id){
            var xhr = new XMLHttpRequest();


            xhr.open("DELETE", "http://localhost:8082/track/verwijderTrack/" + id, true);
            xhr.send();
        }

        function verwijderLocatie(id){
            var xhr = new XMLHttpRequest();


            xhr.open("DELETE", "http://localhost:8082/locatie/verwijderLocatie/" + id, true);
            xhr.send();
        }
    </script>
</head>
<body>
    <header>
        <h1 class="title" id="evenementTitel"></h1>
        <nav>
            <ul>
                <li><a class="active" href="eventoverzicht.html">Evenementen</a></li>
                <li><a onclick="toonTracksPerEvenement()">Tracks</a></li>
                <li><a onclick="toonLocatiesPerEvenement()">Locaties</a></li>
                <li><a href="overzichtaanvragen.html">Aanvragen</a></li>
                <li><a href="planner.html">Planner</a></li>
              </ul>
        </nav>
    </header>
    <main>
        <div id="innerTable">
            
        </div>
    </main>
</body>
</html>