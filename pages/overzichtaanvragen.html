<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="../styles/overzichtStyle.css">
    <script>
        
        function addListenersToActionButtons(){
                 document.querySelectorAll(".actionBtn").forEach((btn)=>btn.addEventListener("click", function(e){
                 const target =e.target;
                 const action = target.dataset.action;
                 const parent = target.closest('.request');
                 parent.classList.add(action)
                //  will have to call update method (in progress)
                // fetch(`http://localhost:8082/updateElementStatus/${parent.dataset.id}/${action}`)
                 
                }))
        }

        //clear the data 
        function clear(){ 
            document.querySelector(".requestList").innerHTML='';
        }

        function refresh(){
            clear();
            toonAanvragen();
        }
        
        function toonAanvragen(){
                
             fetch("http://localhost:8082/getBody")
             .then((request)=>request.json())
             .then((request)=>{
                 const [...data] =request;
                 const wrapper = document.querySelector(".requestList");
                 data.forEach(data => {
                 const html =`
                        <div class="request" data-id='${data.id}' id='request${data.id}'>
                        <div class="data name"><p>Naam: ${data.naam}</p></div>
                        <div class="data surname"><p>Voornaam: ${data.voornaam}</p></div>
                        <div class="data topic"><p>onderwerp: ${data.onderwerp}</p></div>
                        <div class="data email"><p>eMail: <a href="mailto:${data.eMail}">${data.eMail}</a></p></div>
                        <div class="buttons">
                        <div class="actionBtn green" data-action="geaccepteerd"></div>
                        <div class="actionBtn yellow" data-action="gemarkeerd"></div>
                        <div class="actionBtn delete" data-action="afgewezen"></div>
                        </div>
                        </div>`;
                 console.log(data);
                 wrapper.insertAdjacentHTML("afterbegin",html);
                 });
             })
             .then(()=>addListenersToActionButtons()) ;
        }
                
  
    </script>
</head>
<body onload="toonAanvragen()">
    <header>
        <h1 class="title">Aanvragen</h1>
        <nav class="navbar">
            <ul>
                <li><a href="eventoverzicht.html">Evenementen</a></li>
                <li><a href="trackoverzicht.html">Tracks</a></li>
                <li><a href="locatieoverzicht.html">Locaties</a></li>
                <li><a href="overzichtaanvragen.html">Aanvragen</a></li>
                <li><a class="active" href="planner.html">Planner</a></li>
              </ul>
        </nav>
    </header>
    <main>
        <div class="wrapper">
            <button onclick = "refresh()" class="btn">vernieuwen</button>
            <div class="requestList"></div>
       </div>
    </main>
</body>
</html>