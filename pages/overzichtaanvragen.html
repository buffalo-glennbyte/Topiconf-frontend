<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="../styles/overzichtStyle.css">
    <script>
        
        function addListenersToActionButtons(){
                 document.querySelectorAll(".actionBtn").forEach((btn)=>btn.addEventListener("click", function(e){
                 const target =e.target;
                 const action = target.dataset.action;
                 const parent = target.closest('.request');
                 const name = document.querySelector(".name").textContent;
                 const surname = document.querySelector(".surname").textContent;
                 const topic = document.querySelector(".topic").textContent;
                 const email = document.querySelector(".email").textContent;
                 parent.classList.add(action);

                fetch(`http://localhost:8082/getElement/${parent.dataset.id}`).then((element)=>element.json()).then((obj)=>{
                   const o = obj;
                   console.log(o)
                  fetch(`http://localhost:8082/updateElementStatus/${parent.dataset.id}`,
                      {method: "PUT",
                      headers: {'Content-Type': 'application/json'},
                      body: JSON.stringify({
                      id:o.id ,
                      naam: o.naam,
                      voornaam:o.voornaam,
                      onderwerp:o.onderwerp,
                      eMail:o. eMail,
                      status : action})
                })
                })
            }))}
        

        //clear the data 
        function clear(){ 
            document.querySelector(".requestList").innerHTML='';
        }

        function refresh(){
            clear();
            toonAanvragen();
        }
        
        function toonAanvragen(){
                
             fetch("http://localhost:8082/getBody")
             .then((request)=>request.json())
             .then((request)=>{
                 const [...data] =request;
                 const wrapper = document.querySelector(".requestList");
                 data.forEach(data => {
                 const html =`
                        <div class="request" data-id='${data.id}' id='request${data.id}'>
                        <div class="data "><p>Naam:<span class = 'name'> ${data.naam}</span></p></div>
                        <div class="data "><p>Voornaam: <span class = 'surname'>${data.voornaam}</span></p></div>
                        <div class="data "><p>onderwerp:<span class = 'topic'> ${data.onderwerp}</span></p></div>
                        <div class="data "><p>eMail: <a class = 'email' href="mailto:${data.eMail}">${data.eMail}</a></p></div>
                        <div class="buttons">
                        <div class="actionBtn green" data-action="geaccepteerd"></div>
                        <div class="actionBtn yellow" data-action="gemarkeerd"></div>
                        <div class="actionBtn delete" data-action="afgewezen"></div>
                        </div>
                        </div>`;
                 console.log(data);
                 wrapper.insertAdjacentHTML("afterbegin",html);
                 });
             })
             .then(()=>addListenersToActionButtons()) ;
        }
                
  
    </script>
</head>
<body onload="toonAanvragen()">
    
   <div class="wrapper">
   <button onclick = "refresh()" class="btn">vernieuwen</button>
   <div class="requestList"></div>
   </div>
</body>
</html>