<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Login</title>
    <meta name="login to system" content="login" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
      window.onload = function() {
        var submitButton = document.getElementById("submit");
        document.body.addEventListener("keypress", function(event) {
          if (event.key === "Enter") {
          event.preventDefault();
          document.getElementById("submit").click();
          }
        });
      }

      let data;
      var inlog = [];

      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function () {
        if (this.readyState == 4) {
          var alleSprekers = JSON.parse(this.responseText);
          data = alleSprekers;
          for (var x = 0; x < alleSprekers.length; x++) {
            inlog.push(alleSprekers[x].email);
          }
        }
      };
      xhr.open("GET", "http://localhost:8082/persoon/geefAllePersonen", true);
      xhr.send();

      function checkPasswordAndEmail() {
        var username = document.getElementById("emaiInput").value;
        var password = document.getElementById("passwordInput").value;
        let check = data.filter((user) => user.email == username);

        // filter, map en reduce
        if (inlog.includes(username) && (password == "ww")) {
          if (check[0].rol == "s") {
            location.href = "sprekeromgeving.html";
          } else if (check[0].rol == "o") {
            location.href = "organisatoroverzicht.html";
          } else if (check[0].rol == "a") {
            location.href = "administratoromgeving.html";
          } else {
            alert("er ging iets fout");
          }
        // als er 'test' staat in het emailveld, dan controleren op welke testomgeving
        } else if((username.includes("test")) && (password == "ww")) {
          if (username == "testspreker") {
            location.href = "sprekeromgeving.html";
          } else if (username == "testorganisator") {
            location.href = "organisatoromgeving.html";
          } else if (username == "testadministrator") {
            location.href = "administratoromgeving.html";
          } else {
            alert("inloggegevens onjuist")
          }
        } else {
          alert("wachtwoord of email incorrect");
        }
      }
    </script>
    <link rel="stylesheet" href="../styles/style.css" />
  </head>
  <body>
    <div class="wrapper">
      <div class="request_window">
        <h1 class="windowtitle">Login</h1>
        <div class="field">
          <input
            type="email"
            pattern="[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*"
            id="emaiInput"
            class="input"
            placeholder="example@email.nl"
            required
          />
          <label for=""></label>
        </div>
        <div class="field">
          <input
            type="password"
            id="passwordInput"
            class="input"
            placeholder="wachtwoord"
            function="checkpassword()"
            required
          />
          <label for=""></label>
        </div>
        <button
          style="margin: 1%"
          onclick="location.href = 'index.html';"
          class="btn"
        >
          Terug
        </button>

        <input
          id="submit"
          style="margin: 1%"
          type="button"
          class="btn"
          value="Log in"
          name="submit"
          onclick="checkPasswordAndEmail()"
        />
      </div>
    </div>
  </body>
</html>
